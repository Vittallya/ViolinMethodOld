@model IndexViewModel

<link rel="stylesheet" href="~/css/note/tableView.css" />
<link rel="stylesheet" href="~/css/note/tooltip.css" />
<link rel="stylesheet" href="~/css/note/filter.css" />


<button id="bt_filter_toggle" class="btn btn-toggle align-items-center rounded collapsed" data-toggle="collapse" data-target="#filterContainer" aria-expanded="false">
    Фильтр
    <span class="badge" id="filter-count"></span>
</button>

<div class="row">



    <div style="box-shadow: 1px 2px 9px 1px"
         class="rounded-sm col-xm-12 col-sm-12 col-md-12 col-12 col-lg-3 accordion bg-white collapse hide" id="filterContainer">

        <div id="root_filter">
        </div>

    </div>


    <div class="table col-xm-12 col-sm-12 col-md-12 col-12 col-lg-12 justify-content-end" id="table-div">

        <div class="d-flex flex-wrap justify-content-start">


            <div class="d-flex flex-wrap justify-content-start" id="filters-place">

            </div>
        </div>
        <hr />

        <div id="table-panel" class="row">

            <div class="col-xs-4 col-md-3 col-sm-12 col-lg-3 d-flex" style="margin: 5px auto">
                <span>
                    Найдено записей:
                </span>

                <div class="font-weight-bold" style="margin-left: 5px">
                    <span id="finded_text"></span>
                </div>
            </div>
        </div>

        <div id="view_root">

        </div>

        <div class="mt-3">
            <ul id="p_root" class="pagination">
            </ul>
        </div>
    </div>

</div>

@section Scripts{

    <script src="//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.0.943/pdf.min.js" asp-append-version="true"></script>
    <script type="text/javascript" src="~/js/notes/filter.js"></script>
    <script type="text/javascript" src="~/js/notes/index.js"></script>
    <script type="text/javascript" src="~/js/notes/details.js"></script>

    <script>
    $(() => {
        let total = Number( @Model.TotalCount)
        let takeCount = Number(@Model.TakeCount)
        let curPage = Number(@Model.CurrentPage)
        let viewName = "@Model.SelectedView"

        $("#sel-limit").val(takeCount)
        $("#finded_text").text(total)

        $("#bt_filter_toggle").on('click', e => {
            loadFilters($("#root_filter"))

            let viewDiv = $("#table-div")

            if (viewDiv.hasClass('col-lg-12')) {
                viewDiv.removeClass('col-lg-12')
                viewDiv.addClass('col-lg-9')
            }
            else {
                viewDiv.addClass('col-lg-12')
                viewDiv.removeClass('col-lg-9')
            }
        })

        initIndex(curPage, total, takeCount, viewName)
        loadView()
    })



    function onDetails(e) {
        e.stopPropagation()
        $("body > div").removeClass("container").addClass("container-fluid")
        //$("#modal_loading").modal('show')
        let id = $(e.currentTarget).attr('data-id')
        let url = window.location.origin + "/home/details/" + id;

        $.get(url).done(view => {
            placeAjaxView(view)
            //$('#ajax-content-place').empty().append(page)
            //$("#modal_loading").modal('hide')
        }).fail(err => {
            //$("#modal_loading").modal('hide')
            //$("#modal_error").modal('show')
            //$("#modal_error #modal_error_div > ul").empty().append(`<li>Ошибка</li>`)
        })
    }
    </script>
}

